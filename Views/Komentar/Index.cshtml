@model IEnumerable<WebAranzmani.Models.KomentarInfo>
@using WebAranzmani.Models

@{
    ViewBag.Title = "Komentari";
    var korisnik = Session["Korisnik"] as KorisnikInfo;
    bool jeMenadzer = korisnik != null && korisnik.Uloga == Uloga.Menadzer;
    bool jeTurista = korisnik != null && korisnik.Uloga == Uloga.Turista;
}

<style>
    .glass {
        background: rgba(255,255,255,.08);
        border: 1px solid rgba(255,255,255,.18);
        border-radius: 18px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 8px 22px rgba(0,0,0,.25);
    }

    .table thead th {
        background: linear-gradient(90deg,#0e7490,#22d3ee);
        color: #062a3a;
        font-weight: 700;
        border: none;
    }

    .table tbody td {
        vertical-align: middle;
        border-color: rgba(255,255,255,.15) !important;
    }

    .rating {
        color: #facc15;
        font-weight: 700;
    }
</style>

<div class="container my-5">
    <div class="glass p-4">
        <h3 class="fw-bold mb-4">💬 Komentari na odobravanje</h3>

        @if (jeMenadzer)
        {
            <h3 class="fw-bold mb-4">⏳ Komentari na odobravanje</h3>
            <p class="text-muted mb-4">Ovo su komentari koji čekaju vaše odobrenje. Odobrite ih da budu javni ili ih odbijte da se trajno uklone.</p>
        }
        else if (jeTurista)
        {
            <h3 class="fw-bold mb-4">💬 Moji komentari</h3>
            <p class="text-muted mb-4">Ovo su svi komentari koje ste ostavili. Komentari na čekanju će biti javni nakon odobrenja menadžera.</p>
        }
        else
        {
            <h3 class="fw-bold mb-4">💬 Svi komentari</h3>
        }

        @if (TempData["OK"] != null)
        {
            <div class="alert alert-success">@TempData["OK"]</div>
        }
        @if (TempData["Greska"] != null)
        {
            <div class="alert alert-danger">@TempData["Greska"]</div>
        }

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>Turista</th>
                        <th>Smeštaj</th>
                        <th>Tekst</th>
                        <th>Ocena</th>
                        @if (!jeMenadzer)
                        {
                            <th>Status</th>
                        }
                        @if (jeMenadzer)
                        {
                            <th>Akcije</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var k in Model)
                        {
                            <tr class="@(k.Prihvacen ? "table-success" : "table-warning")">
                                <td>@k.Turista</td>
                                <td>@k.SmestajNaziv</td>
                                <td>@k.Sadrzaj</td>
                                <td class="rating">@k.Ocena/5</td>
                                @if (!jeMenadzer)
                                {
                                    <td>
                                        @if (k.Prihvacen)
                                        {
                                            <span class="badge bg-success">✅ Odobren</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-warning">⏳ Na čekanju</span>
                                        }
                                    </td>
                                }
                                @if (jeMenadzer)
                                {
                                    <td>
                                        <div class="d-flex gap-2">
                                            @using (Html.BeginForm("Odobri", "Komentar", FormMethod.Post))
                                            {
                                                @Html.AntiForgeryToken()
                                                @Html.Hidden("id", k.KomentarId)
                                                <button type="submit" class="btn btn-success btn-sm" onclick="return confirm('Odobriti komentar?')">
                                                    ✅ Odobri
                                                </button>
                                            }
                                            @using (Html.BeginForm("Odbij", "Komentar", FormMethod.Post))
                                            {
                                                @Html.AntiForgeryToken()
                                                @Html.Hidden("id", k.KomentarId)
                                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Odbij komentar? Komentar će biti trajno obrisan!')">
                                                    ❌ Odbij
                                                </button>

                                            }
                                        </div>
                                    </td>
                                }
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="@(jeMenadzer ? 5 : 5)" class="text-center text-muted fst-italic">
                                @if (jeMenadzer)
                                {
                                    <text>Nema komentara na čekanju.</text>
                                }
                                else if (jeTurista)
                                {
                                    <text>Nema komentara.</text>
                                }
                                else
                                {
                                    <text>Nema komentara za pregled.</text>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
